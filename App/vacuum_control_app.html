<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vacuum Controller</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.5;
            padding: 16px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #2196F3;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: #1a1a1a;
        }

        .status-info {
            font-size: 0.9rem;
            color: #666;
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 12px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .connected { background-color: #4CAF50; }
        .disconnected { background-color: #f44336; }
        .active { background-color: #2196F3; }
        .idle { background-color: #757575; }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .card {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1a1a1a;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 8px;
        }

        /* Remote Control */
        .control-section {
            text-align: center;
        }

        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 8px;
            width: 180px;
            height: 180px;
            margin: 0 auto 20px;
        }

        .control-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            color: #495057;
        }

        .control-btn:hover {
            background: #e9ecef;
            border-color: #2196F3;
            color: #2196F3;
        }

        .control-btn:active {
            background: #2196F3;
            color: white;
            transform: scale(0.95);
        }

        .control-btn.stop-btn {
            background: #fff5f5;
            border-color: #fed7d7;
            color: #c53030;
        }

        .control-btn.stop-btn:hover {
            background: #fed7d7;
            border-color: #c53030;
        }

        .control-up { grid-column: 2; grid-row: 1; }
        .control-left { grid-column: 1; grid-row: 2; }
        .control-stop { grid-column: 2; grid-row: 2; }
        .control-right { grid-column: 3; grid-row: 2; }
        .control-down { grid-column: 2; grid-row: 3; }

        .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 20px;
            border: 2px solid #2196F3;
            border-radius: 6px;
            background: white;
            color: #2196F3;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            background: #2196F3;
            color: white;
        }

        .action-btn.active {
            background: #2196F3;
            color: white;
        }

        .action-btn.danger {
            border-color: #f44336;
            color: #f44336;
        }

        .action-btn.danger:hover {
            background: #f44336;
            color: white;
        }

        /* Storage Monitor */
        .storage-section {
            text-align: center;
        }

        .storage-display {
            margin-bottom: 20px;
        }

        .storage-bar {
            width: 100%;
            height: 24px;
            background: #f0f0f0;
            border-radius: 12px;
            overflow: hidden;
            margin: 12px 0;
            border: 1px solid #e0e0e0;
        }

        .storage-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: all 0.3s ease;
            border-radius: 12px;
        }

        .storage-fill.warning {
            background: linear-gradient(90deg, #FF9800, #FFC107);
        }

        .storage-fill.danger {
            background: linear-gradient(90deg, #f44336, #FF5722);
        }

        .storage-text {
            font-size: 1.8rem;
            font-weight: 600;
            color: #333;
            margin: 8px 0;
        }

        .storage-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-block;
        }

        .status-ok { background: #e8f5e8; color: #2e7d32; }
        .status-warning { background: #fff8e1; color: #f57c00; }
        .status-danger { background: #ffebee; color: #c62828; }

        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .info-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
        }

        .info-value {
            font-size: 1.6rem;
            font-weight: 600;
            color: #2196F3;
            margin-bottom: 4px;
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
        }

        .info-icon {
            font-size: 1.2rem;
            margin-bottom: 8px;
            display: block;
        }

        /* Alerts */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 320px;
            padding: 16px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-left: 4px solid;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .alert.show {
            opacity: 1;
            transform: translateX(0);
        }

        .alert.success { border-left-color: #4CAF50; }
        .alert.warning { border-left-color: #FF9800; }
        .alert.error { border-left-color: #f44336; }
        .alert.info { border-left-color: #2196F3; }

        .alert-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .alert-message {
            font-size: 0.9rem;
            color: #666;
        }

        /* Schedule Section */
        .schedule-form {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            align-items: center;
        }

        .schedule-input {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            font-size: 0.9rem;
            flex: 1;
        }

        .schedule-input:focus {
            outline: none;
            border-color: #2196F3;
        }

        .schedule-add {
            padding: 8px 16px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .schedule-add:hover {
            background: #1976D2;
        }

        .schedule-list {
            space-y: 8px;
        }

        .schedule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .schedule-remove {
            background: #f44336;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-grid,
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .status-info {
                flex-direction: column;
                gap: 12px;
            }
            
            .control-grid {
                width: 160px;
                height: 160px;
            }
            
            .schedule-form {
                flex-direction: column;
            }
            
            .schedule-input {
                width: 100%;
            }

            body {
                padding: 12px;
            }
        }

        /* Focus indicators for accessibility */
        .control-btn:focus,
        .action-btn:focus,
        .schedule-input:focus,
        .schedule-add:focus {
            outline: 2px solid #2196F3;
            outline-offset: 2px;
        }

        /* Loading state */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            margin: auto;
            border: 2px solid transparent;
            border-top-color: #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Vacuum Robot Controller</h1>
            <div class="status-info">
                <div class="status-item">
                    <div class="status-dot connected" id="connectionDot"></div>
                    <span id="connectionText">Connected</span>
                </div>
                <div class="status-item">
                    <div class="status-dot idle" id="statusDot"></div>
                    <span id="statusText">Ready</span>
                </div>
                <div class="status-item">
                    <span id="lastUpdate">Updated: Now</span>
                </div>
            </div>
        </div>

        <!-- Main Controls -->
        <div class="main-grid">
            <!-- Remote Control -->
            <div class="card">
                <div class="card-title">Remote Control</div>
                <div class="control-section">
                    <div class="control-grid">
                        <button class="control-btn control-up" onclick="sendCommand('forward')" aria-label="Move Forward">▲</button>
                        <button class="control-btn control-left" onclick="sendCommand('left')" aria-label="Turn Left">◄</button>
                        <button class="control-btn control-stop stop-btn" onclick="sendCommand('stop')" aria-label="Stop">●</button>
                        <button class="control-btn control-right" onclick="sendCommand('right')" aria-label="Turn Right">►</button>
                        <button class="control-btn control-down" onclick="sendCommand('backward')" aria-label="Move Backward">▼</button>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="toggleCleaning()" id="cleaningBtn">Start Cleaning</button>
                        <button class="action-btn" onclick="returnHome()">Return Home</button>
                        <button class="action-btn" onclick="toggleAutoMode()" id="autoBtn">Auto Mode</button>
                    </div>
                </div>
            </div>

            <!-- Storage Monitor -->
            <div class="card">
                <div class="card-title">Storage Level</div>
                <div class="storage-section">
                    <div class="storage-display">
                        <div class="storage-text" id="storagePercent">25%</div>
                        <div class="storage-bar">
                            <div class="storage-fill" id="storageFill" style="width: 25%"></div>
                        </div>
                        <div class="storage-status status-ok" id="storageStatus">Storage Available</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Grid -->
        <div class="info-grid">
            <div class="info-card">
                <div class="info-icon">🔋</div>
                <div class="info-value" id="batteryLevel">85%</div>
                <div class="info-label">Battery Level</div>
            </div>
            
            <div class="info-card">
                <div class="info-icon">⏱️</div>
                <div class="info-value" id="runTime">00:00</div>
                <div class="info-label">Runtime</div>
            </div>
            
            <div class="info-card">
                <div class="info-icon">📍</div>
                <div class="info-value" id="robotMode">Manual</div>
                <div class="info-label">Current Mode</div>
            </div>
            
            <div class="info-card">
                <div class="info-icon">🏠</div>
                <div class="info-value" id="homeStatus">Away</div>
                <div class="info-label">Home Status</div>
            </div>
        </div>

        <!-- Schedule -->
        <div class="card" style="margin-top: 16px;">
            <div class="card-title">Schedule Cleaning</div>
            <div class="schedule-form">
                <input type="time" class="schedule-input" id="scheduleTime" value="09:00">
                <select class="schedule-input" id="scheduleDays">
                    <option value="daily">Daily</option>
                    <option value="weekdays">Weekdays Only</option>
                    <option value="weekends">Weekends Only</option>
                </select>
                <button class="schedule-add" onclick="addSchedule()">Add Schedule</button>
            </div>
            
            <div class="schedule-list" id="scheduleList">
                <div class="schedule-item">
                    <span>Daily at 9:00 AM</span>
                    <button class="schedule-remove" onclick="removeSchedule(this)">Remove</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <script>
        // Configuration
        const ESP8266_IP = '192.168.1.100';
        let isConnected = true;
        let isCleaning = false;
        let isAutoMode = false;
        let storageLevel = 25;
        let batteryLevel = 85;
        let startTime = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateDisplay();
            startStatusUpdates();
            setupKeyboardControls();
        });

        // Command sending with proper feedback
        function sendCommand(command) {
            if (!isConnected) {
                showAlert('Connection Error', 'Robot is not connected', 'error');
                return;
            }

            // Visual feedback
            setButtonLoading(true);
            
            fetch(`http://${ESP8266_IP}/${command}`, {
                method: 'GET',
                timeout: 3000
            })
            .then(response => {
                if (response.ok) {
                    handleCommandSuccess(command);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            })
            .catch(error => {
                console.error('Command failed:', error);
                showAlert('Command Failed', `Could not execute: ${command}`, 'error');
                updateConnectionStatus(false);
            })
            .finally(() => {
                setButtonLoading(false);
            });

            // Immediate UI update for responsiveness
            updateRobotStatus(command);
        }

        function handleCommandSuccess(command) {
            const messages = {
                'forward': 'Moving forward',
                'backward': 'Moving backward',
                'left': 'Turning left',
                'right': 'Turning right',
                'stop': 'Stopped'
            };
            
            if (messages[command]) {
                showAlert('Command Sent', messages[command], 'success');
            }
        }

        // Control functions
        function toggleCleaning() {
            const btn = document.getElementById('cleaningBtn');
            if (isCleaning) {
                sendCommand('stop_cleaning');
                btn.textContent = 'Start Cleaning';
                btn.classList.remove('active');
                isCleaning = false;
                startTime = null;
                document.getElementById('robotMode').textContent = 'Manual';
            } else {
                sendCommand('start_cleaning');
                btn.textContent = 'Stop Cleaning';
                btn.classList.add('active');
                isCleaning = true;
                startTime = Date.now();
                document.getElementById('robotMode').textContent = 'Cleaning';
            }
            updateDisplay();
        }

        function returnHome() {
            sendCommand('return_home');
            document.getElementById('homeStatus').textContent = 'Returning';
            showAlert('Return Home', 'Robot is returning to base', 'info');
            
            // Simulate arrival after 30 seconds
            setTimeout(() => {
                document.getElementById('homeStatus').textContent = 'Home';
            }, 30000);
        }

        function toggleAutoMode() {
            const btn = document.getElementById('autoBtn');
            isAutoMode = !isAutoMode;
            
            if (isAutoMode) {
                sendCommand('enable_auto_mode');
                btn.textContent = 'Auto Mode: ON';
                btn.classList.add('active');
                document.getElementById('robotMode').textContent = 'Auto';
                showAlert('Auto Mode', 'Automatic cleaning enabled', 'success');
            } else {
                sendCommand('disable_auto_mode');
                btn.textContent = 'Auto Mode';
                btn.classList.remove('active');
                document.getElementById('robotMode').textContent = 'Manual';
                showAlert('Manual Mode', 'Manual control enabled', 'info');
            }
        }

        // Status updates
        function updateRobotStatus(command) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            const statusMap = {
                'forward': { class: 'active', text: 'Moving Forward' },
                'backward': { class: 'active', text: 'Moving Backward' },
                'left': { class: 'active', text: 'Turning Left' },
                'right': { class: 'active', text: 'Turning Right' },
                'stop': { class: 'idle', text: 'Stopped' },
                'start_cleaning': { class: 'active', text: 'Cleaning' },
                'return_home': { class: 'active', text: 'Returning Home' }
            };
            
            const status = statusMap[command] || { class: 'idle', text: 'Ready' };
            statusDot.className = `status-dot ${status.class}`;
            statusText.textContent = status.text;
            
            updateLastUpdateTime();
        }

        function updateConnectionStatus(connected) {
            isConnected = connected;
            const dot = document.getElementById('connectionDot');
            const text = document.getElementById('connectionText');
            
            if (connected) {
                dot.className = 'status-dot connected';
                text.textContent = 'Connected';
            } else {
                dot.className = 'status-dot disconnected';
                text.textContent = 'Disconnected';
            }
        }

        function updateStorageLevel(level) {
            storageLevel = level;
            const fill = document.getElementById('storageFill');
            const percent = document.getElementById('storagePercent');
            const status = document.getElementById('storageStatus');
            
            percent.textContent = `${level}%`;
            fill.style.width = `${level}%`;
            
            if (level < 50) {
                fill.className = 'storage-fill';
                status.className = 'storage-status status-ok';
                status.textContent = 'Storage Available';
            } else if (level < 85) {
                fill.className = 'storage-fill warning';
                status.className = 'storage-status status-warning';
                status.textContent = 'Getting Full';
            } else {
                fill.className = 'storage-fill danger';
                status.className = 'storage-status status-danger';
                status.textContent = 'Please Empty';
                
                if (level >= 95) {
                    showAlert('Storage Full', 'Please empty the dust container', 'warning');
                }
            }
        }

        function updateRunTime() {
            if (startTime) {
                const elapsed = Date.now() - startTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('runTime').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function updateLastUpdateTime() {
            document.getElementById('lastUpdate').textContent = 
                `Updated: ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
        }

        // Schedule management
        function addSchedule() {
            const time = document.getElementById('scheduleTime').value;
            const days = document.getElementById('scheduleDays').value;
            
            if (!time) {
                showAlert('Invalid Input', 'Please select a time', 'warning');
                return;
            }
            
            const scheduleList = document.getElementById('scheduleList');
            const item = document.createElement('div');
            item.className = 'schedule-item';
            
            const timeStr = new Date(`2000-01-01T${time}`).toLocaleTimeString([], {hour: 'numeric', minute:'2-digit'});
            item.innerHTML = `
                <span>${days} at ${timeStr}</span>
                <button class="schedule-remove" onclick="removeSchedule(this)">Remove</button>
            `;
            
            scheduleList.appendChild(item);
            showAlert('Schedule Added', `${days} cleaning at ${timeStr}`, 'success');
            
            // Reset form
            document.getElementById('scheduleTime').value = '09:00';
            document.getElementById('scheduleDays').value = 'daily';
        }

        function removeSchedule(button) {
            button.parentElement.remove();
            showAlert('Schedule Removed', 'Cleaning schedule deleted', 'info');
        }

        // Alert system
        function showAlert(title, message, type = 'info') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.innerHTML = `
                <div class="alert-title">${title}</div>
                <div class="alert-message">${message}</div>
            `;
            
            container.appendChild(alert);
            setTimeout(() => alert.classList.add('show'), 100);
            
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => container.removeChild(alert), 300);
            }, 4000);
        }

        // Utility functions
        function setButtonLoading(loading) {
            const buttons = document.querySelectorAll('.control-btn, .action-btn');
            buttons.forEach(btn => {
                if (loading) {
                    btn.classList.add('loading');
                } else {
                    btn.classList.remove('loading');
                }
            });
        }

        function updateDisplay() {
            updateStorageLevel(storageLevel);
            document.getElementById('batteryLevel').textContent = `${batteryLevel}%`;
            updateRunTime();
        }

        // Status polling
        function startStatusUpdates() {
            setInterval(() => {
                fetch(`http://${ESP8266_IP}/status`)
                    .then(response => response.json())
                    .then(data => {
                        updateConnectionStatus(true);
                        batteryLevel = data.battery || batteryLevel;
                        updateStorageLevel(data.storage || storageLevel);
                        updateDisplay();
                    })
                    .catch(() => updateConnectionStatus(false));
            }, 5000);
            
            // Update runtime every second
            setInterval(updateRunTime, 1000);
        }

        // Keyboard controls
        function setupKeyboardControls() {
            document.addEventListener('keydown', function(e) {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
                
                const keyMap = {
                    'ArrowUp': 'forward',
                    'ArrowDown': 'backward',
                    'ArrowLeft': 'left',
                    'ArrowRight': 'right',
                    'Space': 'stop',
                    'KeyW': 'forward',
                    'KeyS': 'backward',
                    'KeyA': 'left',
                    'KeyD': 'right'
                };
                
                if (keyMap[e.code]) {
                    e.preventDefault();
                    sendCommand(keyMap[e.code]);
                }
            });
        }

        // Simulate data changes for demo
        setInterval(() => {
            if (isCleaning && Math.random() > 0.7) {
                storageLevel = Math.min(100, storageLevel + Math.floor(Math.random() * 3));
                updateDisplay();
            }
            if (Math.random() > 0.9) {
                batteryLevel = Math.max(0, batteryLevel - 1);
                updateDisplay();
            }
        }, 5000);
    </script>
</body>
</html>